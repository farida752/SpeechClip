2023-03-17 15:09:40,878 INFO    MainThread:50428 [wandb_setup.py:_flush():76] Configure stats pid to 50428
2023-03-17 15:09:40,878 INFO    MainThread:50428 [wandb_setup.py:_flush():76] Loading settings from /root/.config/wandb/settings
2023-03-17 15:09:40,879 INFO    MainThread:50428 [wandb_setup.py:_flush():76] Loading settings from /content/drive/MyDrive/farida_trial/SpeechCLIP/wandb/settings
2023-03-17 15:09:40,879 INFO    MainThread:50428 [wandb_setup.py:_flush():76] Loading settings from environment variables: {}
2023-03-17 15:09:40,879 INFO    MainThread:50428 [wandb_setup.py:_flush():76] Applying setup settings: {'_disable_service': False}
2023-03-17 15:09:40,879 INFO    MainThread:50428 [wandb_setup.py:_flush():76] Inferring run settings from compute environment: {'program_relpath': 'run_task.py', 'program': '/content/drive/MyDrive/farida_trial/SpeechCLIP/run_task.py'}
2023-03-17 15:09:40,879 INFO    MainThread:50428 [wandb_setup.py:_flush():76] Applying login settings: {'mode': 'offline'}
2023-03-17 15:09:40,879 INFO    MainThread:50428 [wandb_init.py:_log_setup():506] Logging user logs to exp_test/wandb/offline-run-20230317_150940-kb9clfn2/logs/debug.log
2023-03-17 15:09:40,880 INFO    MainThread:50428 [wandb_init.py:_log_setup():507] Logging internal logs to exp_test/wandb/offline-run-20230317_150940-kb9clfn2/logs/debug-internal.log
2023-03-17 15:09:40,880 INFO    MainThread:50428 [wandb_init.py:init():546] calling init triggers
2023-03-17 15:09:40,880 INFO    MainThread:50428 [wandb_init.py:init():552] wandb.init called with sweep_config: {}
config: {}
2023-03-17 15:09:40,880 INFO    MainThread:50428 [wandb_init.py:init():602] starting backend
2023-03-17 15:09:40,881 INFO    MainThread:50428 [wandb_init.py:init():606] setting up manager
2023-03-17 15:09:40,887 INFO    MainThread:50428 [backend.py:_multiprocessing_setup():106] multiprocessing start_methods=fork,spawn,forkserver, using: spawn
2023-03-17 15:09:40,893 INFO    MainThread:50428 [wandb_init.py:init():613] backend started and connected
2023-03-17 15:09:40,899 INFO    MainThread:50428 [wandb_init.py:init():701] updated telemetry
2023-03-17 15:09:43,037 INFO    MainThread:50428 [wandb_init.py:init():789] starting run threads in backend
2023-03-17 15:09:43,166 INFO    MainThread:50428 [wandb_run.py:_console_start():2114] atexit reg
2023-03-17 15:09:43,166 INFO    MainThread:50428 [wandb_run.py:_redirect():1969] redirect: SettingsConsole.WRAP_RAW
2023-03-17 15:09:43,167 INFO    MainThread:50428 [wandb_run.py:_redirect():2034] Wrapping output streams.
2023-03-17 15:09:43,167 INFO    MainThread:50428 [wandb_run.py:_redirect():2059] Redirects installed.
2023-03-17 15:09:43,168 INFO    MainThread:50428 [wandb_init.py:init():831] run started, returning control to user process
2023-03-17 15:09:43,170 INFO    MainThread:50428 [wandb_run.py:_config_callback():1251] config_cb None None {'task': 'TrainKWClip_GeneralTransformer', 'config': 'config/speechCLIP/model_base/spchclp_p.yaml', 'save_path': 'exp_test', 'train': True, 'eval': False, 'test': False, 'ckpt': None, 'resume': '', 'njobs': 4, 'gpus': 2, 'seed': 7122, 'dataset_root': '', 'log_level': 'info', 'data': {'dataset': {'name': 'flickr', 'dataset_root': 'data/flickr', 'text_file': 'Flickr8k.token.txt', 'clip_image_transform': 'ViT-B/32', 'load_image': True, 'load_audio': True, 'tokenizeText': True, 'modalities': ['audio', 'image', 'text']}, 'batch_size': 256, 'dev_batch_size': 8, 'split_ratio': 0.9}, 'model_settings': {'cascaded_objective_weight': 0.0, 'parallel_objective_weight': 1.0, 'parallel_branch': {'transformer_type': 'TransformerEncoder', 'transformer_args': {'n_layers': 1, 'd_model': 768, 'nhead': 8, 'dim_feedforward': 3072, 'dropout': 0.1, 'activation': 'gelu', 'layer_norm_eps': 1e-05, 'batch_first': True, 'norm_first': False}, 'need_projection': True}, 'cascaded_branch': {'type': 'KW_CascadedBranch', 'transformer_type': 'MultiheadAttentionAndNorm', 'transformer_args': {'n_layers': 1, 'd_model': 768, 'nhead': 1, 'dim_feedforward': 3072, 'dropout': 0.1, 'activation': 'gelu', 'layer_norm_eps': 1e-05, 'batch_first': True, 'norm_first': False}, 'keyword': {'number': 8, 'detokenized_K_neighbors': 5, 'retrieve_method': 'cosine', 'batchnorms': {'type': 'eachKw', 'std_scale': 1.0, 'learnable': True, 'parallel': True}, 'attention_constraints': {'diversity_per_kw_loss_weight': 0.0, 'diversity_per_frame_loss_weight': 0.0, 'smoothness_per_frame_loss_weight': 0.0}}, 'vq': {'bn_before_vq': True, 'activation': 'gelu', 'type': 'SimpleVectorQuantizer', 'args': {'temp': 'fixed=0.1', 'time_first': True, 'use_gumbel': False, 'hard': True}}}}, 'cl_loss': {'type': 'MaskedContrastiveLoss', 'args': {'temperature': 0.07, 'temperature_trainable': False, 'margin': 0.0, 'dcl': False, 'a2b': True, 'b2a': True}}, 'retrieval': {'audio_feat_src': 'parallel', 'recall_at': [1, 5, 10]}, 'clip': {'name': 'ViT-B/32', 'image_encoder_trainable': False, 'text_encoder_trainable': False, 'reduce_subword_embbedding': './avssl/data/flickr_stat/text_clip_vocab_usage_byfreq.npy'}, 'audio_encoder': {'type': 'FairseqHubert', 'name': 'hubert', 'pretrained': True, 'trainable': False, 'feat_select_idx': 'weighted_sum', 'layer_drop': 0.0, 'max_audio_len': 102400, 'normalize_hiddenstates': False, 'optim': {'name': 'Adam', 'args': {'lr': 0.0001, 'weight_decay': 1e-06}}, 'scheduler': {'name': 'linear_warmup_decay', 'warmup': 5000, 'max_step': 50000, 'final_lr': 1e-08}}, 'trainer': {'max_steps': 50000, 'gradient_clip_val': 4, 'accumulate_grad_batches': 1, 'check_val_every_n_epoch': 1, 'precision': 16, 'logger': 'wandb', 'log_every_n_steps': 8, 'default_root_dir': 'exp_test', 'num_sanity_val_steps': 0, 'strategy': 'dp'}, 'log_setting': {'log_detokenize_results': True, 'log_detokenize_results_every_n_epoch': 5, 'log_draw_pca_every_n_epoch': 10}, 'logger': {'project': 'sphclip'}}
2023-03-17 15:09:44,214 WARNING MsgRouterThr:50428 [router.py:message_loop():77] message_loop has been closed
