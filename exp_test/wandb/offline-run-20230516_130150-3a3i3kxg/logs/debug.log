2023-05-16 13:01:50,651 INFO    MainThread:5097 [wandb_setup.py:_flush():76] Current SDK version is 0.15.2
2023-05-16 13:01:50,651 INFO    MainThread:5097 [wandb_setup.py:_flush():76] Configure stats pid to 5097
2023-05-16 13:01:50,651 INFO    MainThread:5097 [wandb_setup.py:_flush():76] Loading settings from /root/.config/wandb/settings
2023-05-16 13:01:50,651 INFO    MainThread:5097 [wandb_setup.py:_flush():76] Loading settings from /content/drive/.shortcut-targets-by-id/1hWJlyMmsUBvuJJ12dyhT9mwmzQQIIOzL/project/farida_trial/SpeechCLIP/wandb/settings
2023-05-16 13:01:50,652 INFO    MainThread:5097 [wandb_setup.py:_flush():76] Loading settings from environment variables: {}
2023-05-16 13:01:50,652 INFO    MainThread:5097 [wandb_setup.py:_flush():76] Applying setup settings: {'_disable_service': False}
2023-05-16 13:01:50,652 INFO    MainThread:5097 [wandb_setup.py:_flush():76] Inferring run settings from compute environment: {'program_relpath': 'run_task.py', 'program': '/content/drive/.shortcut-targets-by-id/1hWJlyMmsUBvuJJ12dyhT9mwmzQQIIOzL/project/farida_trial/SpeechCLIP/run_task.py'}
2023-05-16 13:01:50,652 INFO    MainThread:5097 [wandb_setup.py:_flush():76] Applying login settings: {'mode': 'offline'}
2023-05-16 13:01:50,652 INFO    MainThread:5097 [wandb_init.py:_log_setup():507] Logging user logs to exp_test/wandb/offline-run-20230516_130150-3a3i3kxg/logs/debug.log
2023-05-16 13:01:50,652 INFO    MainThread:5097 [wandb_init.py:_log_setup():508] Logging internal logs to exp_test/wandb/offline-run-20230516_130150-3a3i3kxg/logs/debug-internal.log
2023-05-16 13:01:50,652 INFO    MainThread:5097 [wandb_init.py:init():547] calling init triggers
2023-05-16 13:01:50,652 INFO    MainThread:5097 [wandb_init.py:init():554] wandb.init called with sweep_config: {}
config: {}
2023-05-16 13:01:50,653 INFO    MainThread:5097 [wandb_init.py:init():596] starting backend
2023-05-16 13:01:50,653 INFO    MainThread:5097 [wandb_init.py:init():600] setting up manager
2023-05-16 13:01:50,656 INFO    MainThread:5097 [backend.py:_multiprocessing_setup():106] multiprocessing start_methods=fork,spawn,forkserver, using: spawn
2023-05-16 13:01:50,659 INFO    MainThread:5097 [wandb_init.py:init():606] backend started and connected
2023-05-16 13:01:50,660 INFO    MainThread:5097 [wandb_init.py:init():700] updated telemetry
2023-05-16 13:01:53,807 INFO    MainThread:5097 [wandb_init.py:init():787] starting run threads in backend
2023-05-16 13:01:53,885 INFO    MainThread:5097 [wandb_run.py:_console_start():2158] atexit reg
2023-05-16 13:01:53,885 INFO    MainThread:5097 [wandb_run.py:_redirect():2013] redirect: SettingsConsole.WRAP_RAW
2023-05-16 13:01:53,886 INFO    MainThread:5097 [wandb_run.py:_redirect():2078] Wrapping output streams.
2023-05-16 13:01:53,886 INFO    MainThread:5097 [wandb_run.py:_redirect():2103] Redirects installed.
2023-05-16 13:01:53,887 INFO    MainThread:5097 [wandb_init.py:init():829] run started, returning control to user process
2023-05-16 13:01:53,888 INFO    MainThread:5097 [wandb_run.py:_config_callback():1286] config_cb None None {'task': 'TrainKWClip_GeneralTransformer', 'config': 'config/speechCLIP/model_large/flickr/spchclp_p.yaml', 'save_path': 'exp_test', 'train': True, 'eval': False, 'test': False, 'ckpt': None, 'resume': '', 'njobs': 4, 'gpus': 1, 'seed': 7122, 'dataset_root': '', 'log_level': 'info', 'data': {'dataset': {'name': 'flickr', 'dataset_root': 'data/Flickr8k', 'text_file': 'Flickr8k.token.txt', 'clip_image_transform': 'ViT-L/14', 'load_image': True, 'load_audio': True, 'tokenizeText': True, 'modalities': ['audio', 'image', 'text']}, 'batch_size': 256, 'dev_batch_size': 8, 'split_ratio': 0.9}, 'model_settings': {'cascaded_objective_weight': 0.0, 'parallel_objective_weight': 1.0, 'parallel_branch': {'transformer_type': 'TransformerEncoder', 'transformer_args': {'n_layers': 1, 'd_model': 1024, 'nhead': 8, 'dim_feedforward': 4096, 'dropout': 0.1, 'activation': 'gelu', 'layer_norm_eps': 1e-05, 'batch_first': True, 'norm_first': False}, 'need_projection': True}, 'cascaded_branch': {'type': 'KW_CascadedBranch', 'transformer_type': 'MultiheadAttentionAndNorm', 'transformer_args': {'n_layers': 1, 'd_model': 1024, 'nhead': 1, 'dim_feedforward': 4096, 'dropout': 0.1, 'activation': 'gelu', 'layer_norm_eps': 1e-05, 'batch_first': True, 'norm_first': False}, 'keyword': {'number': 8, 'detokenized_K_neighbors': 5, 'retrieve_method': 'cosine', 'batchnorms': {'type': 'eachKw', 'std_scale': 1.0, 'learnable': True, 'parallel': True}, 'attention_constraints': {'diversity_per_kw_loss_weight': 0.0, 'diversity_per_frame_loss_weight': 0.0, 'smoothness_per_frame_loss_weight': 0.0}}, 'vq': {'bn_before_vq': True, 'activation': 'gelu', 'type': 'SimpleVectorQuantizer', 'args': {'temp': 'fixed=0.1', 'time_first': True, 'use_gumbel': False, 'hard': True}}}}, 'cl_loss': {'type': 'MaskedContrastiveLoss', 'args': {'temperature': 0.07, 'temperature_trainable': True, 'margin': 0.0, 'dcl': False, 'a2b': True, 'b2a': True}}, 'retrieval': {'audio_feat_src': 'parallel', 'recall_at': [1, 5, 10]}, 'clip': {'name': 'ViT-L/14', 'image_encoder_trainable': False, 'text_encoder_trainable': False, 'reduce_subword_embbedding': './avssl/data/flickr_stat/text_clip_vocab_usage_byfreq.npy'}, 'audio_encoder': {'type': 'FairseqHubert', 'name': 'hubert_large_ll60k', 'pretrained': True, 'trainable': False, 'feat_select_idx': 'weighted_sum', 'layer_drop': 0.0, 'max_audio_len': 102400, 'normalize_hiddenstates': True, 'optim': {'name': 'Adam', 'args': {'lr': 0.0001, 'weight_decay': 1e-06}}, 'scheduler': {'name': 'linear_warmup_decay', 'warmup': 5000, 'max_step': 50000, 'final_lr': 1e-08}}, 'trainer': {'max_steps': 50000, 'gradient_clip_val': 4, 'accumulate_grad_batches': 1, 'check_val_every_n_epoch': 1, 'precision': 16, 'logger': 'wandb', 'log_every_n_steps': 8, 'default_root_dir': 'exp_test', 'num_sanity_val_steps': 0, 'strategy': 'dp'}, 'log_setting': {'log_detokenize_results': True, 'log_detokenize_results_every_n_epoch': 5, 'log_draw_pca_every_n_epoch': 10}, 'logger': {'project': 'sphclip'}}
2023-05-16 13:02:00,670 INFO    MainThread:5097 [wandb_run.py:_config_callback():1286] config_cb None None {'config': "OrderedNamespace({'task': 'TrainKWClip_GeneralTransformer', 'config': 'config/speechCLIP/model_large/flickr/spchclp_p.yaml', 'save_path': 'exp_test', 'train': True, 'eval': False, 'test': False, 'ckpt': None, 'resume': '', 'njobs': 4, 'gpus': 1, 'seed': 7122, 'dataset_root': '', 'log_level': 'info', 'data': {'dataset': {'name': 'flickr', 'dataset_root': 'data/Flickr8k', 'text_file': 'Flickr8k.token.txt', 'clip_image_transform': 'ViT-L/14', 'load_image': True, 'load_audio': True, 'tokenizeText': True}, 'batch_size': 256, 'dev_batch_size': 8, 'split_ratio': 0.9}, 'model_settings': {'cascaded_objective_weight': 0.0, 'parallel_objective_weight': 1.0, 'parallel_branch': {'transformer_type': 'TransformerEncoder', 'transformer_args': {'n_layers': 1, 'd_model': 1024, 'nhead': 8, 'dim_feedforward': 4096, 'dropout': 0.1, 'activation': 'gelu', 'layer_norm_eps': 1e-05, 'batch_first': True, 'norm_first': False}, 'need_projection': True}, 'cascaded_branch': {'type': 'KW_CascadedBranch', 'transformer_type': 'MultiheadAttentionAndNorm', 'transformer_args': {'n_layers': 1, 'd_model': 1024, 'nhead': 1, 'dim_feedforward': 4096, 'dropout': 0.1, 'activation': 'gelu', 'layer_norm_eps': 1e-05, 'batch_first': True, 'norm_first': False}, 'keyword': {'number': 8, 'detokenized_K_neighbors': 5, 'retrieve_method': 'cosine', 'batchnorms': {'type': 'eachKw', 'std_scale': 1.0, 'learnable': True, 'parallel': True}, 'attention_constraints': {'diversity_per_kw_loss_weight': 0.0, 'diversity_per_frame_loss_weight': 0.0, 'smoothness_per_frame_loss_weight': 0.0}}, 'vq': {'bn_before_vq': True, 'activation': 'gelu', 'type': 'SimpleVectorQuantizer', 'args': {'temp': 'fixed=0.1', 'time_first': True, 'use_gumbel': False, 'hard': True}}}}, 'cl_loss': {'type': 'MaskedContrastiveLoss', 'args': {'temperature': 0.07, 'temperature_trainable': True, 'margin': 0.0, 'dcl': False, 'a2b': True, 'b2a': True}}, 'retrieval': {'audio_feat_src': 'parallel', 'recall_at': [1, 5, 10]}, 'clip': {'name': 'ViT-L/14', 'image_encoder_trainable': False, 'text_encoder_trainable': False, 'reduce_subword_embbedding': './avssl/data/flickr_stat/text_clip_vocab_usage_byfreq.npy'}, 'audio_encoder': {'type': 'FairseqHubert', 'name': 'hubert_large_ll60k', 'pretrained': True, 'trainable': False, 'feat_select_idx': 'weighted_sum', 'layer_drop': 0.0, 'max_audio_len': 102400, 'normalize_hiddenstates': True, 'optim': {'name': 'Adam', 'args': {'lr': 0.0001, 'weight_decay': 1e-06}}, 'scheduler': {'name': 'linear_warmup_decay', 'warmup': 5000, 'max_step': 50000, 'final_lr': 1e-08}}, 'trainer': {'max_steps': 50000, 'gradient_clip_val': 4, 'accumulate_grad_batches': 1, 'check_val_every_n_epoch': 1, 'precision': 16, 'logger': 'wandb', 'log_every_n_steps': 8, 'default_root_dir': 'exp/sphclip_large_p_flickr', 'num_sanity_val_steps': 0, 'strategy': 'dp'}, 'log_setting': {'log_detokenize_results': True, 'log_detokenize_results_every_n_epoch': 5, 'log_draw_pca_every_n_epoch': 10}, 'logger': {'project': 'sphclip'}})"}
2023-05-16 13:06:13,800 WARNING MsgRouterThr:5097 [router.py:message_loop():77] message_loop has been closed
